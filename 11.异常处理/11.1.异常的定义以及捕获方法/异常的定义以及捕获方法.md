# 什么是异常？

Q1：程序在调用函数时可能会报错，那么调用方如何得知调用失败的信息？

A1：

1.  方法一：约定错误码。例如 C 语言中一个函数通过返回不同的数字（0，1等）表示正常执行或出现错误。
2.  方法二：使用异常处理机制。

---



Q2：异常的本质是什么？

A2：Java 中，**异常本质上就是一个 class**。它的**继承关系如下**：

![image-20201011093834153](https://gitee.com/llillz/images/raw/master/image-20201011093834153.png)

从继承树可知，**`Throwable` 是异常体系的根。它又分出两类：`Error` 和 `Exception`**。前者表示严重的错误，一般程序无法处理，如：

-   `OutOfMemoryError`：内存耗尽
-   `NoClassDefFoundError`：无法加载某个Class
-   `StackOverflowError`：栈溢出

后者表示可以被捕获并处理的错误，如：

-   `NumberFormatException`：数值类型的格式错误
-   `FileNotFoundException`：未找到文件
-   `SocketException`：读取网络失败



# 如何捕获异常？

Q3：哪些异常必须捕获，而哪些可以视情况而定？

A3：Java 规定：

-   **必须捕获的异常**，包括`Exception`及其子类，但不包括`RuntimeException`及其子类，这种类型的异常**称为 Checked Exception**。
-   不需要捕获的异常，包括`Error`及其子类，`RuntimeException`及其子类。



---

Q4：如何捕获异常？

A4：使用 `try ... catch` 语句，例如

```java
import java.io.UnsupportedEncodingException;
import java.util.Arrays;

import static java.lang.System.out;

public class Instance {
    public static void main(String[] args) {
        byte[] bs = toGBK("中文");
        out.println(Arrays.toString(bs));
    }

    static byte[] toGBK(String s) {
        try {
            return s.getBytes("GBK"); // 如果不支持GBK编码，则抛出异常，使用默认编码
        } catch (UnsupportedEncodingException e) {
            out.println(e);
            return s.getBytes();
        }
    }
}
```

-   在这里，必须捕获 `getBytes` 方法的异常，否则编译器会提示错误。在这里，编辑器已经检查出了错误：

    ![image-20201011100423185](https://gitee.com/llillz/images/raw/master/image-20201011100423185.png)

-   这是因为 `getBytes` 方法的声明的 `throws` 关键字强制规定了必须捕获 `UnsupportedEncodingException` 异常：

    ```java
    public byte[] getBytes(String charsetName) throws UnsupportedEncodingException {...}
    ```

    

**注**：只要是方法声明的 Checked Exception，不在调用层捕获，也必须在更高的调用层捕获。所有未捕获的异常，最终也必须在`main()`方法中捕获，不会出现漏写`try`的情况。这是由编译器保证的。`main()`方法也是最后捕获`Exception`的机会。



# 小结

1.  异常本质上就是 class，根是 `Throwable` ，它又分为 `Error` 和 `Exception` 两类。
2.  `Exception` 可分为 `RuntimeException` 以及其他异常类。其中后者是必须捕获的，被称作 Checked Exception。而 `Error` 和 `RuntimeException` 可以依情况而定。
3.  使用 `try ... catch` 语句捕获异常。
4.  声明中带有 `throws` 关键字的方法必须在它的调用方或是更高层进行捕获。